<div class="row-fluid">
	<div class="span4">
    <fieldset>
		<legend>Projets</legend>
		<table class="table table-bordered table-hover">
			<thead class="btn-primary disabled">
				<tr>
					<td >Nom du projet</td>
				</tr>
			</thead>
			<tbody id="nomProjet">
			</tbody>
			<tfoot>
				<tr>
					<td><button class="btn btn-primary" id="callFormProjet" data-toggle="modal" data-target="#form-projet"> Ajouter</button></td>
				</tr>
			</tfoot>
		</table>
	</fieldset>
    </div>
    <div class="span4">
	<fieldset>
		<legend>Familles</legend>
		<table class="table table-bordered table-hover">
			<thead class="btn-primary disabled">
				<tr >
					<td>Intitulé de la famille de tâches</td>
				</tr>
			</thead>
			<tbody id="nomFamille">
			</tbody>
			<tfoot>
				<tr>
					<td><button class="btn btn-primary" id="callFormFamille" data-toggle="modal" data-target="#form-famille">Ajouter</button></td>
				</tr>
			</tfoot>
		</table>
	</fieldset>
    </div>
    <div class="span4">
	<fieldset>
		<legend>Livrables</legend>
		<table class="table table-bordered table-hover">
			<thead class="btn-primary disabled">
				<tr>
					<td>Intitulé du livrable</td>
				</tr>
			</thead>
			<tbody id="nomLivrable">
			</tbody>
			<tfoot>
				<tr>
					<td><button class="btn btn-primary" id="callFormLivrable" data-toggle="modal" data-target="#form-livrable">Ajouter</button></td>
				</tr>
			</tfoot>
		</table>
	</fieldset>
    </div>
</div>
<div class="row-fluid">
    <div class="span4">
	<fieldset>
		<legend>Catégories</legend>
		<table class="table table-bordered table-hover">
			<thead class="btn-primary disabled">
				<tr>
					<td >Intitulé de la catégorie</td>
				</tr>
			</thead>
			<tbody id="nomCategorie">
			</tbody>
			<tfoot>
				<tr>
					<td><button class="btn btn-primary" id="callFormCategorie" data-toggle="modal" data-target="#form-categorie">Ajouter</button></td>
				</tr>
			</tfoot>
		</table>
	</fieldset>
    </div>
    <div class="span4">
	<fieldset>
		<legend>Ressources</legend>
		<table class="table table-bordered table-hover">
			<thead class="btn-primary disabled">
				<tr>
					<td >Nom</td>
					<td >Catégorie</td>
					<td >Coût/H</td>
				</tr>
			</thead>
			<tbody id="nomRessource">
			</tbody>
			<tfoot>
				<tr>
					<td colspan="3"><button class="btn btn-primary" id="callFormUser" data-toggle="modal" data-target="#form-user">Ajouter</button></td>
				</tr>
			</tfoot>
		</table>
	</fieldset>
    </div>
    <div class="span4">
	<fieldset>
		<legend>Paramètres</legend>
		<table class="table table-bordered table-hover">
			<thead class="btn-primary disabled">
				<tr>
					<td>Quota heures/J</td>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><input type="number" name="quota" id="parametre" style="text-align:center;"/></td>
				</tr>
			</tbody>
			<tfoot>
				<tr>
					<td><button class="btn btn-primary" id="addQuota">Mettre à Jour</button></td>
				</tr>
			</tfoot>
		</table>
	</fieldset>
    </div>
</div>
<div class="modal fade" id="form-user" tabindex="-1" role="dialog"
     aria-labelledby="labelUser" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="labelUser">
                    Ajouter une ressource
                </h4>
            </div>
            <div class="modal-body" id="addFormUser">
                <form class="form-horizontal">
                    <div class="row-fluid">
                        <div class="form-group">
                            <div class="col-md-12">
                                <label class="control-label" for="Nom">Nom</label>
                                <input class="form-control" type="text" id="nomRes">
                                <label class="control-label" for="Categorie">Catégorie</label>
                                <select class="form-control" id="selectCateg"></select>
                                <label class="control-label" for="coutHoraire">Coût Horaire</label>
                                <input class="form-control" type="number" id="coutRes" min="0">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">
                    Cancel
                </button>
                <button type="button" id="addUser" class="btn btn-primary">
                    Ajouter
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="form-projet" tabindex="-1" role="dialog"
     aria-labelledby="labelProjet" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="labelProjet">
                    Ajouter un projet
                </h4>
            </div>
            <div class="modal-body" id="addFormProjet">
                <form class="form-horizontal">
                    <div class="row-fluid">
                        <div class="form-group">
                            <div class="col-md-12">
                                <label class="control-label" for="Nom">Nom du projet</label>
                                <input class="form-control" type="text" id="nomProj">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" id="addProjet" class="btn btn-primary">Ajouter</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="form-famille" tabindex="-1" role="dialog"
     aria-labelledby="labelFamille" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="labelFamille">
                    Ajouter une famille de tâche
                </h4>
            </div>
            <div class="modal-body" id="addFormFamille">
                <form class="form-horizontal">
                    <div class="row-fluid">
                        <div class="form-group">
                            <div class="col-md-12">
                                <label class="control-label" for="nom">Nom de la famille</label>
                                <input class="form-control" type="text" id="nomFam">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" id="addFamille" class="btn btn-primary">Ajouter</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="form-livrable" tabindex="-1" role="dialog"
     aria-labelledby="labelLivrable" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="labelLivrable">
                    Ajouter un livrable
                </h4>
            </div>
            <div class="modal-body" id="addFormLivrable">
                <form class="form-horizontal">
                    <div class="row-fluid">
                        <div class="form-group">
                            <div class="col-md-12">
                                <label class="control-label" for="nom">Nom de la livrable</label>
                                <input class="form-control" type="text" id="nomLiv">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" id="addLivrable" class="btn btn-primary">Ajouter</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="form-categorie" tabindex="-1" role="dialog"
     aria-labelledby="labelCategorie" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="labelCategorie">
                    Ajouter un categorie
                </h4>
            </div>
            <div class="modal-body" id="addFormCategorie">
                <form class="form-horizontal">
                    <div class="row-fluid">
                        <div class="form-group">
                            <div class="col-md-12">
                                <label class="control-label" for="nom">Nom de la categorie</label>
                                <input class="form-control" type="text" id="nomCat">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" id="addCategorie" class="btn btn-primary">Ajouter</button>
            </div>
        </div>
    </div>
</div>
<script>
    /* Gestion Formulaire Add User */
    $(function() {
        var nomRes = $( "#nomRes" ),
        coutRes = $("#coutRes"),
		categ = $("#selectCateg"),
        allFields = $( [] ).add( nomRes).add(coutRes),
        tips = $( ".validateTips" );

        function updateTips( t ) {
            tips
				.text( t )
				.addClass( "ui-state-highlight" );
            setTimeout(function() {
                tips.removeClass( "ui-state-highlight", 1500 );
            }, 500 );
        }

        function checkLength( o, n, min, max ) {
            if ( o.val().length > max || o.val().length < min ) {
                o.addClass( "ui-state-error" );
                updateTips( "Length of " + n + " must be between " +
                        min + " and " + max + "." );
                return false;
            } else {
                return true;
            }
        }

        function checkRegexp( o, regexp, n ) {
            if ( !( regexp.test( o.val() ) ) ) {
                o.addClass( "ui-state-error" );
                updateTips( n );
                return false;
            } else {
                return true;
            }
        }

        function addUser() {
            var valid = true;
            allFields.removeClass( "ui-state-error" );

            valid = valid && checkLength( nomRes, "username", 3, 255 );
			valid = valid && checkRegexp( nomRes, /^[a-z]([0-9a-z_\s])+$/i, "Votre nom peut contenir les caractères suivants : a-z, 0-9, underscores, espaces et doit commencer par une lettre." );
            valid = valid && checkLength( categ, "username", 1, 5 );

            if ( valid ) {
				$.ajax({
					type: "POST",
					url: "http://localhost/Developement/queries/parametres.php",
					dataType: 'json',
					contentType:'application/json',
					data: '{"objet" : "ressource",	"nomRessource" : "' + $("#nomRes").val()+ '","tauxHoraire" : "'+ $("#coutRes").val()+'","codeCatPerso" : "'+ $("#selectCateg").val()+'" }',
					success : function(){
						majData();
                        $('#form-user').modal('hide');;
					},
					error : function(){
						alert("Y'a un souci")
                        $('#form-user').modal('hide');
					}
				});
            }
            return valid;
        }

        $( "#addUser" ).on( "click", function() {
            addUser();
        });

        $("#callFormUser").on("click", function(){
            $('#addFormUser').find('input:text').val('');
            $('selectCateg').reset();
            $('#coutRes').val('');
        });
    });

    /* Gestion Formulaire Add Projet */
	$(function() {

        var nomProjet = $( "#nomProj" ),
        allFields = $( [] ).add( nomProjet),
        tips = $( ".validateTips" );

        function updateTips( t ) {
            tips
				.text( t )
				.addClass( "ui-state-highlight" );
            setTimeout(function() {
                tips.removeClass( "ui-state-highlight", 1500 );
            }, 500 );
        }

        function checkLength( o, n, min, max ) {
            if ( o.val().length > max || o.val().length < min ) {
                o.addClass( "ui-state-error" );
                updateTips( "Length of " + n + " must be between " +
                        min + " and " + max + "." );
                return false;
            } else {
                return true;
            }
        }

        function addProjet() {
            var valid = true;
            allFields.removeClass( "ui-state-error" );

            valid = valid && checkLength( nomProjet, "projet", 3, 255 );

            if ( valid ) {
				$.ajax
			    ({
			        type: "POST",
			        url: "http://localhost/Developement/queries/parametres.php",
			        dataType: 'json',
			        contentType:'application/json',
			        data: '{"objet": "projet","libelleProjet": "' + $("#nomProj").val() + '"}',
			        success: function () {
			        	majData();
                        $('#form-projet').modal('hide');;
                    },
                    error : function(){
                        alert("Y'a un souci")
                        $('#form-projet').modal('hide');
                    }
			    })
            }
            return valid;
        }

        $( "#addProjet" ).button().on( "click", function() {
            addProjet();
        });
        $("#callFormProjet").on("click", function(){
            $('#addFormProjet').find('input:text').val('');
        });
    });

    /* Gestion formulaire Add Famille */
	$(function() {

        var nomFamille = $( "#nomFam" ),
        allFields = $( [] ).add( nomFamille),
        tips = $( ".validateTips" );

        function updateTips( t ) {
            tips
				.text( t )
				.addClass( "ui-state-highlight" );
            setTimeout(function() {
                tips.removeClass( "ui-state-highlight", 1500 );
            }, 500 );
        }

        function checkLength( o, n, min, max ) {
            if ( o.val().length > max || o.val().length < min ) {
                o.addClass( "ui-state-error" );
                updateTips( "Length of " + n + " must be between " +
                        min + " and " + max + "." );
                return false;
            } else {
                return true;
            }
        }

        function addFamille() {
            var valid = true;
            allFields.removeClass( "ui-state-error" );

            valid = valid && checkLength( nomFamille, "famille", 3, 255 );

            if ( valid ) {
				$.ajax
			    ({
			        type: "POST",
			        url: "http://localhost/Developement/queries/parametres.php",
			        dataType: 'json',
			        contentType:'application/json',
			        data: '{"objet": "famille","libelleFamille": "' + $("#nomFam").val() + '"}',
			        success: function () {
			        	majData();
                        $('#form-famille').modal('hide');;
                    },
                    error : function(){
                        alert("Y'a un souci")
                        $('#form-famille').modal('hide');
                    }
			    })
            }
            return valid;
        }

        $( "#callFormFamille" ).button().on( "click", function() {
            $('#addFormFamille').find('input:text').val('');
        });
    });

    /*Gestion formulaire Add Livrable */
	$(function() {

        var nomLivrable = $( "#nomLiv" ),
        allFields = $( [] ).add( nomFamille),
        tips = $( ".validateTips" );

        function updateTips( t ) {
            tips
				.text( t )
				.addClass( "ui-state-highlight" );
            setTimeout(function() {
                tips.removeClass( "ui-state-highlight", 1500 );
            }, 500 );
        }

        function checkLength( o, n, min, max ) {
            if ( o.val().length > max || o.val().length < min ) {
                o.addClass( "ui-state-error" );
                updateTips( "Length of " + n + " must be between " +
                        min + " and " + max + "." );
                return false;
            } else {
                return true;
            }
        }

        function addLivrable() {
            var valid = true;
            allFields.removeClass( "ui-state-error" );

            valid = valid && checkLength( nomLivrable, "livrable", 3, 255 );

            if ( valid ) {
				$.ajax
			    ({
			        type: "POST",
			        url: "http://localhost/Developement/queries/parametres.php",
			        dataType: 'json',
			        contentType:'application/json',
			        data: '{"objet": "livrable","libelleLivrable": "' + $("#nomLiv").val() + '"}',
			        success: function () {
			        	majData();
                        $('#form-livrable').modal('hide');;
                    },
                    error : function(){
                        alert("Y'a un souci")
                        $('#form-livrable').modal('hide');
                    }
			    })
            }
            return valid;
        }

        $( "#addLivrable" ).button().on( "click", function() {
            addLivrable();
        });

        $( "#callFormLivrable" ).button().on( "click", function() {
            $('#addFormLivrable').find('input:text').val('');
        });
    });

    /* Gestion formulaire Add Catégorie */
	$(function() {
        var nomCategorie = $( "#nomCat" ),
        allFields = $( [] ).add( nomCategorie),
        tips = $( ".validateTips" );

        function updateTips( t ) {
            tips
				.text( t )
				.addClass( "ui-state-highlight" );
            setTimeout(function() {
                tips.removeClass( "ui-state-highlight", 1500 );
            }, 500 );
        }

        function checkLength( o, n, min, max ) {
            if ( o.val().length > max || o.val().length < min ) {
                o.addClass( "ui-state-error" );
                updateTips( "Length of " + n + " must be between " +
                        min + " and " + max + "." );
                return false;
            } else {
                return true;
            }
        }

        function addCategorie() {
            var valid = true;
            allFields.removeClass( "ui-state-error" );

            valid = valid && checkLength( nomCategorie, "livrable", 3, 255 );

            if ( valid ) {
				$.ajax
			    ({
			        type: "POST",
			        url: "http://localhost/Developement/queries/parametres.php",
			        dataType: 'json',
			        contentType:'application/json',
			        data: '{"objet": "categ","libelleCategorie": "' + $("#nomCat").val() + '"}',
			        success: function () {
			        	majData();
                        $('#form-categorie').modal('hide');;
                    },
                    error : function(){
                        alert("Y'a un souci")
                        $('#form-categorie').modal('hide');
                    }
			    })
            }
            return valid;
        }

        $( "#addCategorie" ).button().on( "click", function() {
            addCategorie();
        });

        $( "#callFormCategorie" ).button().on( "click", function() {
            $('#addFormCategorie').find('input:text').val('');
        });
    });

	$ (function (){
        $( "#addQuota" ).button().on( "click", function() {
            $.ajax
            ({
                type: "POST",
                url: "http://localhost/Developement/queries/parametres.php",
                dataType: 'json',
                contentType: 'application/json',
                data: '{"objet": "parametre","dureeLegale": "' + $("#parametre").val() + '"}',
                success: function () {
                    majData();
                }
            })
        });
	})
</script>
<script>
	function majData(){
		$("#nomProjet").empty();
		$("#nomFamille").empty();
		$("#nomLivrable").empty();
		$("#nomCategorie").empty();
		$("#selectCateg").empty();
		$("#nomRessource").empty();
		$("#parametre").val();

		$.getJSON("http://localhost/Developement/queries/parametres.php?objet=projets", function(data){
			if(jQuery.parseJSON(data.data) !== false)
			jQuery.parseJSON(data.data).forEach(function (currentValue) {
				$("#nomProjet").append("<tr><td>" + currentValue.libelleProjet + "</td></tr>");
			});
            $.getJSON("http://localhost/Developement/queries/parametres.php?objet=livrables", function(data){
                if(jQuery.parseJSON(data.data) !== false)
                jQuery.parseJSON(data.data).forEach(function (currentValue) {
                    $("#nomLivrable").append("<tr><td >" + currentValue.libelleLivrable + "</td></tr>");
                });
                $.getJSON("http://localhost/Developement/queries/parametres.php?objet=categs", function(data){
                    if(jQuery.parseJSON(data.data) !== false)
                    jQuery.parseJSON(data.data).forEach(function (currentValue) {
                        $("#nomCategorie").append("<tr><td >" + currentValue.libelleCategorie + "</td></tr>");
                        $("#selectCateg").append("<option value=\"" + currentValue.codeCategorie + "\">" + currentValue.libelleCategorie + "</option>");
                    });
                    $.getJSON("http://localhost/Developement/queries/parametres.php?objet=familles", function(data){
                        if(jQuery.parseJSON(data.data) !== false)
                        jQuery.parseJSON(data.data).forEach(function (currentValue) {
                            $("#nomFamille").append("<tr><td >" + currentValue.libelleFamille + "</td></tr>");
                        });
                        $.getJSON("http://localhost/Developement/queries/parametres.php?objet=parametres", function(data){
                            if(jQuery.parseJSON(data.data) !== false)
                            jQuery.parseJSON(data.data).forEach(function (currentValue) {
                                $("#parametre").val(currentValue.dureeLegale);
                            });
                            $.getJSON("http://localhost/Developement/queries/parametres.php?objet=ressources", function(data){
                                if(jQuery.parseJSON(data.data) !== false)
                                jQuery.parseJSON(data.data).forEach(function (currentValue) {
                                    $("#nomRessource").append("<tr><td> " + currentValue.nomRessource + "</td><td>" + currentValue.libelleCategorie + "</td><td> " + currentValue.tauxHoraire + "</td></tr>");
                                });
                            });
                        });
                    });
                });
            });
		});

	}

	majData();
</script>