<div class="row-fluid">
	<div class="span4">
    <fieldset>
		<legend>Projets</legend>
		<table class="table table-bordered table-hover">
			<thead class="btn-primary disabled">
				<tr>
					<td >Nom du projet</td>
				</tr>
			</thead>
			<tbody id="nomProjet">
			</tbody>
			<tfoot>
				<tr>
					<td><button id="addProjet"><i class="icon-plus" ></i> Ajouter</button></td>
				</tr>
			</tfoot>
		</table>
	</fieldset>
    </div>
    <div class="span4">
	<fieldset>
		<legend>Familles</legend>
		<table class="table table-bordered table-hover">
			<thead class="btn-primary disabled">
				<tr >
					<td>Intitulé de la famille de tâches</td>
				</tr>
			</thead>
			<tbody id="nomFamille">
			</tbody>
			<tfoot>
				<tr>
					<td><button id="addFamille"><i class="icon-plus" ></i>Ajouter</button></td>
				</tr>
			</tfoot>
		</table>
	</fieldset>
    </div>
    <div class="span4">
	<fieldset>
		<legend>Livrables</legend>
		<table class="table table-bordered table-hover">
			<thead class="btn-primary disabled">
				<tr>
					<td>Intitulé du livrable</td>
				</tr>
			</thead>
			<tbody id="nomLivrable">
			</tbody>
			<tfoot>
				<tr>
					<td><button id="addLivrable"><i class="icon-plus" ></i>Ajouter</button></td>
				</tr>
			</tfoot>
		</table>
	</fieldset>
    </div>
</div>
<div class="row-fluid">
    <div class="span4">
	<fieldset>
		<legend>Catégories</legend>
		<table class="table table-bordered table-hover">
			<thead class="btn-primary disabled">
				<tr>
					<td >Intitulé de la catégorie</td>
				</tr>
			</thead>
			<tbody id="nomCategorie">
			</tbody>
			<tfoot>
				<tr>
					<td><button id="addCategorie"><i class="icon-plus" ></i>Ajouter</button></td>
				</tr>
			</tfoot>
		</table>
	</fieldset>
    </div>
    <div class="span4">
	<fieldset>
		<legend>Ressources</legend>
		<table class="table table-bordered table-hover">
			<thead class="btn-primary disabled">
				<tr>
					<td >Nom</td>
					<td >Catégorie</td>
					<td >Coût/H</td>
				</tr>
			</thead>
			<tbody id="nomRessource">
			</tbody>
			<tfoot>
				<tr>
					<td ><button id="addUser"><i class="icon-plus" ></i>Ajouter</button></td>
				</tr>
			</tfoot>
		</table>
	</fieldset>
    </div>
    <div class="span4">
	<fieldset>
		<legend>Paramètres</legend>
		<table class="table table-bordered table-hover">
			<thead class="btn-primary disabled">
				<tr>
					<td>Quota heures/J</td>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><input type="number" name="quota" id="parametre" style="text-align:center;"/></td>
				</tr>
			</tbody>
			<tfoot>
				<tr>
					<td><button id="addQuota"><i class="icon-plus" ></i>Mettre à Jour</button></td>
				</tr>
			</tfoot>
		</table>
	</fieldset>
    </div>
</div>
<div id="dialog-form-user" title="Ajouter une ressource">
    <form >
        <div><label for="Nom">Nom</label>
        <input type="text" id="nomRes"></div>
        <div><label for="Categorie">Catégorie</label>
        <select id="selectCateg"></select></div>
        <div><label for="Cout Horaire">Coût Horaire</label>
        <input type="number" id="coutRes" min="0"></div>
    </form>
</div>
<div id="dialog-form-projet" title="Ajouter un projet">
    <form>
        <div><label for="Nom du projet">Nom</label>
        <input type="text" id="nomProj"></div>
    </form>
</div>
<div id="dialog-form-famille" title="Ajouter une famille de tâches">
    <form>
        <div><label for="Nom de la famille">Nom</label>
        <input type="text" id="nomFam"></div>
    </form>
</div>
<div id="dialog-form-livrable" title="Ajouter un livrable">
    <form>
        <div><label for="Nom du livrable">Nom</label>
        <input type="text" id="nomLiv"></div>
    </form>
</div>
<div id="dialog-form-categorie" title="Ajouter une catégorie de personnel">
    <form>
        <div><label for="Nom de la catégorie">Nom</label>
        <input type="text" id="nomCat"></div>
    </form>
</div>
<script>
    $(function() {
        var dialogUser, formUser,

		nomRes = $( "#nomRes" ),
        coutRes = $("#coutRes"),
		categ = $("#selectCateg"),
        allFields = $( [] ).add( nomRes).add(coutRes),
        tips = $( ".validateTips" );

        function updateTips( t ) {
            tips
				.text( t )
				.addClass( "ui-state-highlight" );
            setTimeout(function() {
                tips.removeClass( "ui-state-highlight", 1500 );
            }, 500 );
        }

        function checkLength( o, n, min, max ) {
            if ( o.val().length > max || o.val().length < min ) {
                o.addClass( "ui-state-error" );
                updateTips( "Length of " + n + " must be between " +
                        min + " and " + max + "." );
                return false;
            } else {
                return true;
            }
        }

        function checkRegexp( o, regexp, n ) {
            if ( !( regexp.test( o.val() ) ) ) {
                o.addClass( "ui-state-error" );
                updateTips( n );
                return false;
            } else {
                return true;
            }
        }

        function addUser() {
            var valid = true;
            allFields.removeClass( "ui-state-error" );

            valid = valid && checkLength( nomRes, "username", 3, 255 );
			valid = valid && checkRegexp( nomRes, /^[a-z]([0-9a-z_\s])+$/i, "Votre nom peut contenir les caractères suivants : a-z, 0-9, underscores, espaces et doit commencer par une lettre." );
            valid = valid && checkLength( categ, "username", 1, 5 );

            if ( valid ) {
				$.ajax({
					type: "POST",
					url: "http://localhost/Developement/queries/parametres.php",
					dataType: 'json',
					contentType:'application/json',
					data: '{"objet" : "ressource",	"nomRessource" : "' + $("#nomRes").val()+ '","tauxHoraire" : "'+ $("#coutRes").val()+'","codeCatPerso" : "'+ $("#selectCateg").val()+'" }',
					success : function(){
						majData();
						dialogUser.dialog("close");
					},
					error : function(){
						alert("Y'a un souci")
						dialogUser.dialog("close");
					}
				});
            }
            return valid;
        }

        dialogUser = $( "#dialog-form-user" ).dialog({
            autoOpen: false,
            height: 300,
            width: 350,
            modal: true,
            buttons: {
                "Ajouter": addUser,
                Cancel: function() {
                    dialogUser.dialog( "close" );
                }
            },
            close: function() {
                formUser[ 0 ].reset();
                allFields.removeClass( "ui-state-error" );
            }
        });

        formUser = dialogUser.find( "form" ).on( "submit", function( event ) {
            event.preventDefault();
            addUser();
        });

        $( "#addUser" ).button().on( "click", function() {
            dialogUser.dialog( "open" );
        });
    });

	$(function() {
        var dialogProjet, formProjet,

		nomProjet = $( "#nomProj" ),
        allFields = $( [] ).add( nomProjet),
        tips = $( ".validateTips" );

        function updateTips( t ) {
            tips
				.text( t )
				.addClass( "ui-state-highlight" );
            setTimeout(function() {
                tips.removeClass( "ui-state-highlight", 1500 );
            }, 500 );
        }

        function checkLength( o, n, min, max ) {
            if ( o.val().length > max || o.val().length < min ) {
                o.addClass( "ui-state-error" );
                updateTips( "Length of " + n + " must be between " +
                        min + " and " + max + "." );
                return false;
            } else {
                return true;
            }
        }

        function addProjet() {
            var valid = true;
            allFields.removeClass( "ui-state-error" );

            valid = valid && checkLength( nomProjet, "projet", 3, 255 );

            if ( valid ) {
				$.ajax
			    ({
			        type: "POST",
			        url: "http://localhost/Developement/queries/parametres.php",
			        dataType: 'json',
			        contentType:'application/json',
			        data: '{"objet": "projet","libelleProjet": "' + $("#nomProj").val() + '"}',
			        success: function () {
			        	majData();
			        	dialogProjet.dialog("close");
			        }
			    })
            }
            return valid;
        }

        dialogProjet = $( "#dialog-form-projet" ).dialog({
            autoOpen: false,
            height: 300,
            width: 350,
            modal: true,
            buttons: {
                "Ajouter": addProjet,
                Cancel: function() {
                    dialogProjet.dialog( "close" );
                }
            },
            close: function() {
                formProjet[ 0 ].reset();
                allFields.removeClass( "ui-state-error" );
            }
        });

        formProjet = dialogProjet.find( "form" ).on( "submit", function( event ) {
            event.preventDefault();
            addProjet();
        });

        $( "#addProjet" ).button().on( "click", function() {
            dialogProjet.dialog( "open" );
        });
    });

	$(function() {
        var dialogFamille, formFamille,

		nomFamille = $( "#nomFam" ),
        allFields = $( [] ).add( nomFamille),
        tips = $( ".validateTips" );

        function updateTips( t ) {
            tips
				.text( t )
				.addClass( "ui-state-highlight" );
            setTimeout(function() {
                tips.removeClass( "ui-state-highlight", 1500 );
            }, 500 );
        }

        function checkLength( o, n, min, max ) {
            if ( o.val().length > max || o.val().length < min ) {
                o.addClass( "ui-state-error" );
                updateTips( "Length of " + n + " must be between " +
                        min + " and " + max + "." );
                return false;
            } else {
                return true;
            }
        }

        function addFamille() {
            var valid = true;
            allFields.removeClass( "ui-state-error" );

            valid = valid && checkLength( nomFamille, "famille", 3, 255 );

            if ( valid ) {
				$.ajax
			    ({
			        type: "POST",
			        url: "http://localhost/Developement/queries/parametres.php",
			        dataType: 'json',
			        contentType:'application/json',
			        data: '{"objet": "famille","libelleFamille": "' + $("#nomFam").val() + '"}',
			        success: function () {
			        	majData();
			        	dialogFamille.dialog("close");
			        }
			    })
            }
            return valid;
        }

        dialogFamille = $( "#dialog-form-famille" ).dialog({
            autoOpen: false,
            height: 300,
            width: 350,
            modal: true,
            buttons: {
                "Ajouter": addFamille,
                Cancel: function() {
                    dialogFamille.dialog( "close" );
                }
            },
            close: function() {
                formFamille[ 0 ].reset();
                allFields.removeClass( "ui-state-error" );
            }
        });

        formFamille = dialogFamille.find( "form" ).on( "submit", function( event ) {
            event.preventDefault();
            addFamille();
        });

        $( "#addFamille" ).button().on( "click", function() {
            dialogFamille.dialog( "open" );
        });
    });

	$(function() {
        var dialogLivrable, formLivrable,

		nomLivrable = $( "#nomLiv" ),
        allFields = $( [] ).add( nomFamille),
        tips = $( ".validateTips" );

        function updateTips( t ) {
            tips
				.text( t )
				.addClass( "ui-state-highlight" );
            setTimeout(function() {
                tips.removeClass( "ui-state-highlight", 1500 );
            }, 500 );
        }

        function checkLength( o, n, min, max ) {
            if ( o.val().length > max || o.val().length < min ) {
                o.addClass( "ui-state-error" );
                updateTips( "Length of " + n + " must be between " +
                        min + " and " + max + "." );
                return false;
            } else {
                return true;
            }
        }

        function addLivrable() {
            var valid = true;
            allFields.removeClass( "ui-state-error" );

            valid = valid && checkLength( nomLivrable, "livrable", 3, 255 );

            if ( valid ) {
				$.ajax
			    ({
			        type: "POST",
			        url: "http://localhost/Developement/queries/parametres.php",
			        dataType: 'json',
			        contentType:'application/json',
			        data: '{"objet": "livrable","libelleLivrable": "' + $("#nomLiv").val() + '"}',
			        success: function () {
			        	majData();
			        	dialogLivrable.dialog("close");
			        }
			    })
            }
            return valid;
        }

        dialogLivrable = $( "#dialog-form-livrable" ).dialog({
            autoOpen: false,
            height: 300,
            width: 350,
            modal: true,
            buttons: {
                "Ajouter": addLivrable,
                Cancel: function() {
                    dialogLivrable.dialog( "close" );
                }
            },
            close: function() {
                formLivrable[ 0 ].reset();
                allFields.removeClass( "ui-state-error" );
            }
        });

        formLivrable = dialogLivrable.find( "form" ).on( "submit", function( event ) {
            event.preventDefault();
            addLivrable();
        });

        $( "#addLivrable" ).button().on( "click", function() {
            dialogLivrable.dialog( "open" );
        });
    });

	$(function() {
        var dialogCategorie, formCategorie,

		nomCategorie = $( "#nomCat" ),
        allFields = $( [] ).add( nomCategorie),
        tips = $( ".validateTips" );

        function updateTips( t ) {
            tips
				.text( t )
				.addClass( "ui-state-highlight" );
            setTimeout(function() {
                tips.removeClass( "ui-state-highlight", 1500 );
            }, 500 );
        }

        function checkLength( o, n, min, max ) {
            if ( o.val().length > max || o.val().length < min ) {
                o.addClass( "ui-state-error" );
                updateTips( "Length of " + n + " must be between " +
                        min + " and " + max + "." );
                return false;
            } else {
                return true;
            }
        }

        function addCategorie() {
            var valid = true;
            allFields.removeClass( "ui-state-error" );

            valid = valid && checkLength( nomCategorie, "livrable", 3, 255 );

            if ( valid ) {
				$.ajax
			    ({
			        type: "POST",
			        url: "http://localhost/Developement/queries/parametres.php",
			        dataType: 'json',
			        contentType:'application/json',
			        data: '{"objet": "categ","libelleCategorie": "' + $("#nomCat").val() + '"}',
			        success: function () {
			        	majData();
			        	dialogCategorie.dialog("close");
			        }
			    })
            }
            return valid;
        }

        dialogCategorie = $( "#dialog-form-categorie" ).dialog({
            autoOpen: false,
            height: 300,
            width: 350,
            modal: true,
            buttons: {
                "Ajouter": addCategorie,
                Cancel: function() {
                    dialogCategorie.dialog( "close" );
                }
            },
            close: function() {
                formCategorie[ 0 ].reset();
                allFields.removeClass( "ui-state-error" );
            }
        });

        formCategorie = dialogCategorie.find( "form" ).on( "submit", function( event ) {
            event.preventDefault();
            addCategorie();
        });

        $( "#addCategorie" ).button().on( "click", function() {
            dialogCategorie.dialog( "open" );
        });
    });

	$ (function (){
        $( "#addQuota" ).button().on( "click", function() {
            $.ajax
            ({
                type: "POST",
                url: "http://localhost/Developement/queries/parametres.php",
                dataType: 'json',
                contentType: 'application/json',
                data: '{"objet": "parametre","dureeLegale": "' + $("#parametre").val() + '"}',
                success: function () {
                    majData();
                }
            })
        });
	})
</script>
<script>
	function majData(){
		$("#nomProjet").empty();
		$("#nomFamille").empty();
		$("#nomLivrable").empty();
		$("#nomCategorie").empty();
		$("#selectCateg").empty();
		$("#nomRessource").empty();
		$("#parametre").val();

		$.getJSON("http://localhost/Developement/queries/parametres.php?objet=projets", function(data){
			if(jQuery.parseJSON(data.data) !== false)
			jQuery.parseJSON(data.data).forEach(function (currentValue) {
				$("#nomProjet").append("<tr><td>" + currentValue.libelleProjet + "</td></tr>");
			});
		});

		$.getJSON("http://localhost/Developement/queries/parametres.php?objet=livrables", function(data){
			if(jQuery.parseJSON(data.data) !== false)
			jQuery.parseJSON(data.data).forEach(function (currentValue) {
				$("#nomLivrable").append("<tr><td >" + currentValue.libelleLivrable + "</td></tr>");
			});
		});

		$.getJSON("http://localhost/Developement/queries/parametres.php?objet=categs", function(data){
			if(jQuery.parseJSON(data.data) !== false)
			jQuery.parseJSON(data.data).forEach(function (currentValue) {
				$("#nomCategorie").append("<tr><td >" + currentValue.libelleCategorie + "</td></tr>");
				$("#selectCateg").append("<option value=\"" + currentValue.codeCategorie + "\">" + currentValue.libelleCategorie + "</option>");
			});
		});

		$.getJSON("http://localhost/Developement/queries/parametres.php?objet=familles", function(data){
			if(jQuery.parseJSON(data.data) !== false)
			jQuery.parseJSON(data.data).forEach(function (currentValue) {
				$("#nomFamille").append("<tr><td >" + currentValue.libelleFamille + "</td></tr>");
			});
		});

		$.getJSON("http://localhost/Developement/queries/parametres.php?objet=parametres", function(data){
			if(jQuery.parseJSON(data.data) !== false)
			jQuery.parseJSON(data.data).forEach(function (currentValue) {
				$("#parametre").val(currentValue.dureeLegale);
			});
		});

		$.getJSON("http://localhost/Developement/queries/parametres.php?objet=ressources", function(data){
			if(jQuery.parseJSON(data.data) !== false)
			jQuery.parseJSON(data.data).forEach(function (currentValue) {
				$("#nomRessource").append("<tr><td> " + currentValue.nomRessource + "</td><td>" + currentValue.libelleCategorie + "</td><td> " + currentValue.tauxHoraire + "</td></tr>");
			});
		});

	}

	majData();
</script>